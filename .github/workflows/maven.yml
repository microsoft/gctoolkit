# This workflow will build a Java project with Maven
# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven

name: GCToolKit build with Maven

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        java: [11, 17]

    steps:
    - uses: actions/checkout@v2

    - name: Cache Maven
      uses: actions/cache@v2.1.4
      with:
        path: ~/.m2/repository
        key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
        restore-keys: ${{ runner.os }}-m2

    - name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v2
      with:
        java-version: ${{ matrix.java }}
        distribution: 'adopt'
        server-id: github # Value of the distributionManagement/repository/id field of the pom.xml
        settings-path: ${{ github.workspace }} # location for the settings.xml file
        
    - name: Build with Maven
      run: ./mvnw -B package --file pom.xml --settings $GITHUB_WORKSPACE/settings.xml
      #run: ./mvnw -B package -Pcontributor --file pom.xml --settings $GITHUB_WORKSPACE/settings.xml
      env:
        GITHUB_TOKEN: ${{ github.token }}

    #- name: Generate JaCoCo Badges for core/api
    #  id: coreApi
    #  uses: cicirello/jacoco-badge-generator@v2
    #  with:
    #    generate-branches-badge: true
    #    jacoco-csv-file: core/api/target/site/jacoco/jacoco.csv
    #    coverage-badge-filename: jacoco-api-coverage.svg
    #    branches-badge-filename: jacoco-api-branches.svg

    #- name: Generate JaCoCo Badges for core/parser
    #  id: coreParser
    #  uses: cicirello/jacoco-badge-generator@v2
    #  with:
    #    generate-branches-badge: true
    #    jacoco-csv-file: core/parser/target/site/jacoco/jacoco.csv
    #    coverage-badge-filename: jacoco-parser-coverage.svg
    #    branches-badge-filename: jacoco-parser-branches.svg
#
    #- name: Generate JaCoCo Badges for core/vertx
    #  id: coreVertx
    #  uses: cicirello/jacoco-badge-generator@v2
    #  with:
    #    generate-branches-badge: true
    #    jacoco-csv-file: core/vertx/target/site/jacoco/jacoco.csv
    #    coverage-badge-filename: jacoco-vertx-coverage.svg
    #    branches-badge-filename: jacoco-vertx-branches.svg
#
    #- name: Auto Commit the badge (if it changed)
    #  # Do not run this for pull_request events as it fails with the message:
    #  #     error: pathspec 'refs/pull/50/merge' did not match any file(s) known to git
    #  if: ${{ !startsWith(github.event_name, 'pull_request') }}
    #  uses: stefanzweifel/git-auto-commit-action@v4
    #  with:
    #    commit_message: Autogenerated JaCoCo coverage badge
    #    file_pattern: .github/badges/*.svg
    #  env:
    #    GITHUB_TOKEN: ${{ github.token }}
